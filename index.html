<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Hanzi Writer 作業：指定漢字（每字一遍）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@latest/dist/hanzi-writer.min.js"></script>
  <style>
    :root { --w: 260px; }
    body { font-family: "Noto Sans TC","Microsoft JhengHei",sans-serif; margin: 20px; }
    h1 { font-size: 20px; margin: 0 0 10px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 16px; max-width: 720px; }
    .chips { display: flex; gap: 8px; flex-wrap: wrap; margin: 6px 0 10px; }
    .chip { border: 1px solid #ccc; border-radius: 999px; padding: 6px 10px; font-size: 14px; }
    .chip.done { background: #e8f7e8; border-color: #9ad09a; }
    #writer { width: var(--w); height: var(--w); border: 1px dashed #bbb; border-radius: 12px; margin: 12px 0; }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    button { padding: 10px 14px; font-size: 15px; border-radius: 10px; border: 1px solid #ccc; background: #f8f8f8; cursor: pointer; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    .muted { color:#666; }
    .success { color:#0a7c2f; font-weight:700; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Hanzi Writer 作業：指定漢字（每字一遍）</h1>
    <p class="muted">教師指定：<strong id="assigned"></strong></p>

    <div class="row" style="margin:6px 0 10px;">
      <button id="btnStart">開始作業</button>
      <span id="hint" class="muted">按「開始作業」後，依序完成每個漢字的描紅練習即可。</span>
    </div>

    <div id="stage" style="display:none;">
      <div class="chips" id="chips"></div>
      <div id="writer"></div>
      <div class="row">
        <button id="btnAnimate">播放筆順動畫</button>
        <button id="btnQuiz">開始描紅</button>
      </div>
      <p id="progress" class="muted"></p>
      <p id="doneMsg" class="success"></p>
    </div>
  </div>

  <script>
    // 指定漢字（老師提供）
    const ASSIGNED_CHARS = ['釋','寶','餘','歲','壽','團','圓','蘿','蔔','糕'];

    // 狀態
    let writer = null;
    let idx = 0; // 目前進行到第幾個字

    // 元件
    const elAssigned = document.getElementById('assigned');
    const elStart = document.getElementById('btnStart');
    const elStage = document.getElementById('stage');
    const elChips = document.getElementById('chips');
    const elWriter = document.getElementById('writer');
    const elAnimate = document.getElementById('btnAnimate');
    const elQuiz = document.getElementById('btnQuiz');
    const elProgress = document.getElementById('progress');
    const elDoneMsg = document.getElementById('doneMsg');

    // 顯示指定清單
    elAssigned.textContent = ASSIGNED_CHARS.join('、');

    function renderChips() {
      elChips.innerHTML = '';
      ASSIGNED_CHARS.forEach((c, i) => {
        const span = document.createElement('span');
        span.className = 'chip' + (i < idx ? ' done' : '');
        span.textContent = c;
        elChips.appendChild(span);
      });
    }

    function initWriter(char) {
      elWriter.innerHTML = '';
      writer = HanziWriter.create('writer', char, {
        width: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--w')),
        height: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--w')),
        padding: 8,
        showOutline: true,
        showCharacter: false
      });
    }

    function updateProgress() {
      elProgress.textContent = `進度：第 ${idx+1}/${ASSIGNED_CHARS.length} 個字「${ASSIGNED_CHARS[idx]}」`;
    }

    function startQuizOnce() {
      writer.quiz({
        onComplete: () => {
          idx += 1;
          renderChips();
          if (idx < ASSIGNED_CHARS.length) {
            initWriter(ASSIGNED_CHARS[idx]);
            updateProgress();
          } else {
            elAnimate.disabled = true;
            elQuiz.disabled = true;
            elDoneMsg.textContent = '✅ 全部完成！請截圖此畫面作為完成證明。';
          }
        }
      });
    }

    // 事件
    elStart.addEventListener('click', () => {
      idx = 0;
      elDoneMsg.textContent = '';
      elStage.style.display = 'block';
      renderChips();
      initWriter(ASSIGNED_CHARS[idx]);
      updateProgress();
    });

    elAnimate.addEventListener('click', () => { if (writer) writer.animateCharacter(); });
    elQuiz.addEventListener('click', () => { if (writer) startQuizOnce(); });
  </script>
</body>
</html>
